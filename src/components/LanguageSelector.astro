---
import Globe from './icons/Globe.astro';

const currentPath = Astro.url.pathname;
const currentLang = currentPath.startsWith('/en') ? 'EN' : currentPath.startsWith('/pr') ? 'PR' : 'ES';

const languages = [
  { code: 'es', label: 'EspaÃ±ol', flag: 'ğŸ‡ªğŸ‡¸' },
  { code: 'en', label: 'English', flag: 'ğŸ‡ºğŸ‡¸' },
  { code: 'pr', label: 'PortuguÃªs', flag: 'ğŸ‡§ğŸ‡·' }
];
---

<div class="relative language-selector">
  <button
    id="lang-toggle"
    class="flex items-center gap-2 px-3 py-2 rounded-lg opacity-70 hover:opacity-100 transition-all duration-300 hover:bg-white/10"
    aria-label="Select language"
  >
    <Globe class="size-5" />
    <span class="hidden sm:inline">{currentLang}</span>
    <svg class="size-4 transition-transform duration-300" id="lang-arrow" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <div
    id="lang-menu"
    class="absolute top-full mt-2 right-0 bg-black/95 backdrop-blur-lg rounded-lg shadow-lg border border-white/10 hidden min-w-[160px]"
  >
    {languages.map(lang => (
      <a
        href={`/${lang.code}/`}
        class="flex items-center gap-3 px-4 py-3 hover:bg-white/10 transition-colors first:rounded-t-lg last:rounded-b-lg"
      >
        <span class="text-2xl">{lang.flag}</span>
        <span>{lang.label}</span>
      </a>
    ))}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('lang-toggle');
    const menu = document.getElementById('lang-menu');
    const arrow = document.getElementById('lang-arrow');
    let isOpen = false;

    toggle?.addEventListener('click', (e) => {
    e.stopPropagation();
    isOpen = !isOpen;

    if (isOpen) {
        menu?.classList.remove('hidden');
        arrow?.style.setProperty('transform', 'rotate(180deg)');
    } else {
        menu?.classList.add('hidden');
        arrow?.style.setProperty('transform', 'rotate(0deg)');
    }
    });

    // Cerrar al hacer clic fuera
    document.addEventListener('click', () => {
    if (isOpen) {
        isOpen = false;
        menu?.classList.add('hidden');
        arrow?.style.setProperty('transform', 'rotate(0deg)');
    }
    });
});
</script>